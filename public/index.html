<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Orange Pi NAS Monitor</title>
		<style>
			* {
				font-family: monospace;
			}
			body {
				margin: 0;
				padding: 0;
				background-color: #f4f4f9;
				color: #333;
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh; /* Use min-height instead of height for better responsiveness */
			}
			.container {
				max-width: 800px;
				width: 90%; /* Make the container width responsive */
				margin: 20px auto; /* Reduce margin for smaller screens */
				padding: 20px;
				background: #fff;
				border-radius: 8px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				position: relative;
			}
			h1 {
				text-align: center;
				font-size: 24px; /* Adjust font size for smaller screens */
			}
			.storage-item {
				margin-bottom: 20px;
				padding: 15px;
				background: #f9f9f9;
				border-radius: 8px;
				border: 1px solid #ddd;
			}
			.storage-item h2 {
				margin-top: 0;
				font-size: 18px; /* Adjust font size for smaller screens */
			}
			.progress-bar {
				width: 100%;
				height: 20px;
				background: #e0e0e0;
				border-radius: 10px;
				overflow: hidden;
			}
			.progress {
				height: 100%;
				background: #76c7c0;
			}
			#login-form {
				max-width: 400px;
				width: 90%; /* Make the form width responsive */
				padding: 20px;
				background: #fff;
				border-radius: 8px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				margin: 20px auto; /* Center the form and add margin */
			}
			#login-form input {
				width: calc(100% - 20px); /* Adjust width to account for padding */
				padding: 10px;
				margin: 10px 0;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 16px; /* Adjust font size for better readability on mobile */
			}
			#login-form button {
				width: 100%; /* Make the button full width */
				padding: 10px;
				background: #ff902e;
				border: none;
				border-radius: 4px;
				color: #fff;
				cursor: pointer;
				font-size: 16px; /* Adjust font size for better readability on mobile */
			}
			#login-form button:hover {
				background: #5aa6a0;
			}
			#logout-button {
				position: fixed;
				top: 10px;
				right: 10px;
				padding: 8px 16px;
				background: #ff4d4d;
				border: none;
				border-radius: 4px;
				color: #fff;
				cursor: pointer;
				font-size: 14px;
			}
			#logout-button:hover {
				background: #e60000;
			}

			#main-content {
				margin-right: 0px;
				margin-left: 0px;
			}

			#left-sidebar {
				all: unset;
				position: fixed;
				left: 0;
				width: 200px;
				height: 100vh;
				overflow-y: auto;
				background-color: #f7f6f3;
				box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
				z-index: 1;
			}

			#left-sidebar ul {
				padding-inline-start: 0;
			}

			#left-sidebar ul li {
				font-size: 1.2rem;
				list-style: none;
				margin-top: 1rem;
				width: 100%;
			}

			#left-sidebar ul li a {
				all: unset;
				display: flex;
				justify-content: center;
				align-items: center;
				cursor: pointer;
				height: 100%;
			}

			#left-sidebar ul li a:hover {
				background-color: black;
			}

			@media (max-width: 600px) {
				h1 {
					font-size: 20px;
				}
				.storage-item h2 {
					font-size: 16px;
				}
				#login-form {
					padding: 15px;
				}
				#login-form input {
					width: calc(100% - 20px);
					font-size: 14px;
				}
				#login-form button {
					font-size: 14px;
				}

				#left-sidebar {
					visibility: hidden;
				}

				#disks {
					width: 95%;
					left: 50%;
					transform: translateX(-50%);
					max-height: 85vh; /* Slightly smaller height on mobile */
				}
			}

			@media (min-width: 800px) {
				#disks {
					left: calc(
						50% + 120px
					); /* Push it further right for better centering */
				}
			}
			#disks {
				position: absolute;
				left: calc(50% + 100px); /* Shift right to balance sidebar */
				transform: translateX(-50%);
				width: 75%;
				max-width: 1000px; /* Prevents being too wide on large screens */
				padding: 20px;
				background: #fff;
				border-radius: 8px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				min-height: auto; /* Removes excessive height */
				max-height: 90vh; /* Prevents overflowing from viewport */
				overflow-y: auto; /* Enables scrolling if content is too long */
			}
		</style>
	</head>
	<body>
		<!-- Sidebar -->
		<section id="left-sidebar" style="display: none">
			<ul>
				<li><a href="#" onclick="showPage('dashboard')">üè† Dashboard</a></li>
				<li><a href="#" onclick="showPage('disks')">üíæ Disks</a></li>
				<li><a href="#" onclick="showPage('settings')">‚öôÔ∏è Settings</a></li>
				<li><a href="#" onclick="logout()">üö™ Logout</a></li>
			</ul>
		</section>

		<!-- Pages -->
		<div id="login-form">
			<h2>Login</h2>
			<input type="text" id="username" placeholder="Username" />
			<input type="password" id="password" placeholder="Password" />
			<button onclick="login()">Login</button>
		</div>

		<div id="dashboard" class="page" style="display: none">
			<h1>Dashboard</h1>
			<p>Welcome to your dashboard!</p>
		</div>

		<!-- New Disks Page -->
		<div id="disks" style="display: none">
			<h1>Storage Disks</h1>
			<div id="storage-list"></div>
		</div>

		<div id="settings" class="page" style="display: none">
			<h1>Settings</h1>
			<p>Change your preferences here.</p>
		</div>

		<script>
			function showPage(pageId) {
				// Hide all pages
				document.querySelectorAll(".page").forEach((page) => {
					page.style.display = "none";
				});

				// Also hide the Disks page manually
				document.getElementById("disks").style.display = "none";

				// Show selected page
				document.getElementById(pageId).style.display = "block";

				// If "disks" page is opened, fetch storage data
				if (pageId === "disks") {
					document.getElementById("disks").style.display = "block"; // Show Disks
					fetchStorageData();
				}
			}

			async function login() {
				const username = document.getElementById("username").value;
				const password = document.getElementById("password").value;

				const response = await fetch("/api/login", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ username, password }),
				});

				const data = await response.json();
				if (data.token) {
					localStorage.setItem("token", data.token);
					document.getElementById("login-form").style.display = "none";
					document.getElementById("left-sidebar").style.display = "block";
					showPage("dashboard"); // Show dashboard after login
				} else {
					alert("Login failed. Please check your credentials.");
				}
			}

			function logout() {
				localStorage.clear();
				location.reload(); // Reload to show login page again
			}

			async function fetchStorageData() {
				const token = localStorage.getItem("token");
				if (!token) return; // Stop if not logged in

				const response = await fetch("/api/storage", {
					headers: { Authorization: `Bearer ${token}` },
				});

				if (response.ok) {
					const data = await response.json();
					const storageList = document.getElementById("storage-list");
					storageList.innerHTML = ""; // Clear previous data

					let count = 0;
					for (const [name, info] of Object.entries(data)) {
						const storageItem = document.createElement("div");
						storageItem.className = "storage-item";
						count++;
						let emoji = "";

						const progress = (info.used / info.total) * 100;
						let progressColor =
							progress > 75 ? "#ff4d4d" : progress > 50 ? "#ff8f05" : "#76c7c0";

						switch (count) {
							case 1:
								emoji = "üìº";
								break;
							case 2:
								emoji = "üíæ";
								break;
							case 3:
								emoji = "üóÉÔ∏è";
								break;
						}

						storageItem.innerHTML = `
						<h2>${emoji} ${name}</h2>
						<p>Total: ${info.total} GB</p>
						<p>Used: ${info.used} GB</p>
						<p>Free: ${info.free} GB</p>
						<div class="progress-bar">
							<div class="progress" style="width: ${progress}%; background: ${progressColor};"></div>
						</div>
					`;
						storageList.appendChild(storageItem);
					}
				} else {
					localStorage.clear();
					alert("Failed to fetch storage data. Please log in again.");
					window.location.reload();
				}
			}

			// Check if user is logged in on page load
			window.onload = () => {
				const token = localStorage.getItem("token");
				if (token) {
					document.getElementById("login-form").style.display = "none";
					document.getElementById("left-sidebar").style.display = "block";

					// Show page from URL or default to dashboard
					const page = window.location.hash.replace("#", "") || "dashboard";
					showPage(page);
				} else {
					document.getElementById("left-sidebar").style.display = "none";
				}
			};
		</script>
	</body>
</html>
